---
title: 浏览器缓存  # 博客标题（必须）
subtitle: 一点自己对浏览器缓存的理解  # 博客副标题（可选）
date: 2022-04-11  # 博客日期，会显示在文章头部（可选）
author: Xumushan # 博客作者（可选，不填的话会使用 `themeConfig.personalInfo.name`）
# header_style: image  # 是否在博客中显示封面图：`image`（显示） / `text`（不显示）（可选，默认为 `text`）
header_img: /img/firstBlog.jpg  # 博客封面图（必须，即使上一项选了 `text`，图片也需要在首页显示）
header_mask: rgba(40, 57, 101, .4)  # 封面图遮罩（可选）
catalog: true  # 是否启用右侧目录：false / true（可选，默认为 false）
---

## 浏览器缓存相关

- 浏览器缓存是指一个Web资源（HTML、图片，JS等）存在于Web服务器和客户端之间的副本
  
- 缓存会根据进来的请求保存输出内容的副本、当下一个相同URl请求来的时候，根据缓存机制来决定是否使用副本响应访问请求，还是像服务器再次发送请求。
  

缓存一般分为两类

- 强缓存
  
- 协商缓存
  

### 强缓存

浏览器在发送请求之前，会先去缓存中查看是否命中强缓存，如果命中，则直接从缓存中读取资源，**不发送请求到服务器** 。

Expires

其值为服务器返回该请求结果缓存的到期时间。

即再次发起该请求时候，如果客户端时间小于expires的值，直接使用缓存结果

> Tips：expires的控制缓存的原理是使用客户端的时间与服务端的时间做对比的，如果客户端于服务端的时间因为某些原因（时区不同等）发生误差，那么强缓存可能会直接失效。

### Cache-Control

**Cache-Control的优先级高于Expires** 。它的主要取值为：

- public：所有内容都将被缓存（客户端和代理服务器都可缓存
  
- private：所有内容只有客户端可以缓存，Cache-Control的默认取值
  
- no-cache：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定
  
- no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存
  
- max-age=xxx (xxx is numeric)：缓存内容将在xxx秒后失效
  

## 协商缓存

当强缓存没有命中时，浏览器会发送请求到服务器，服务器根据请求头（Request Header）中的一些字段来判断是否命中协商缓存。如果命中，服务器则返回304响应，不携带任何响应实体，仅仅告知浏览器从缓存中获取这个资源。

### Last-Modified

Last-Modified是服务器响应请求时，返回该资源文件在服务器最后被修改的时间

##### If-Modified-Since

If-Modified-Since则是客户端再次发起该请求时，携带上次请求返回的Last-Modified值，通过此字段值告诉服务器该资源上次请求返回的最后被修改时间。

##### Etag

Etag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，如下

##### If-None-Match

If-None-Match是客户端再次发起该请求时，携带上次请求返回的唯一标识Etag值，通过此字段值告诉服务器该资源上次请求返回的唯一标识值

## 总结

强缓存总是优先于协商缓存，若强缓存生效则直接使用缓存。若不生效则进行协商缓存。

如果协商缓存也失效，则代表该缓存已经失效，重新获取请求结果存入浏览器缓存中。生效则返回304.